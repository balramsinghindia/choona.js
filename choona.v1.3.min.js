/*   choona.js 1.3
     (c) 2011-2013 Narendra Sisodiya, narendra@narendrasisodiya.com
     
     choona.js is distributed under the MIT license.
     
     For all details and documentation:
     https://github.com/nsisodiya/choona.js
*/
var EventBus=function(){this.NewsPaperList={},this.OrderList=[]};EventBus.prototype={subscribe:function(a,b){if(typeof a!="string"||typeof b!="function")return-1;var c=this.NewsPaperList[a];typeof c!="object"&&(c=this.NewsPaperList[a]=[]);var d=c.push(b)-1;return this.OrderList.push({newsPaper:a,customer:d})-1},unsubscribe:function(a){var b=this.OrderList[a];b!==undefined&&(delete this.NewsPaperList[b.newsPaper][b.customer],delete b)},publish:function(a,b){var c=this.NewsPaperList[a];if(typeof c!="undefined"){var d=c.length;for(var e=0;e<d;e++)typeof c[e]=="function"&&c[e].call(this,b)}}};var choona=function(){var a={debug:!1,log:function(a){this.debug===!0&&typeof console=="object"&&typeof console.log=="function"&&console.log(a)}},b=new EventBus,c=function(a){this.id=a,this.$=null,this.topicList={},this.moduleList={},this.eventBus=null};c.Private={endAllModules:function(){for(var a in this.moduleList)this.moduleList[a].end();this.moduleList={}},unsubscribeAll:function(){for(var a in this.topicList)this.unsubscribe(a)},eraseUI:function(){this.$.innerHTML=""},getModule:function(a){if(this.moduleList[a]===undefined)throw new Error("id::"+a+" is do not has any module. Please use, this.sb.startModule function to load module");return this.moduleList[a]},endSandbox:function(){delete this.$,delete this.id,delete this.moduleList,delete this.eventBus,delete this.topicList}},c.prototype={subscribe:function(b,c){this.topicList[b]=this.eventBus.subscribe(b,c),a.log("subscribed topic -> "+b)},getNewEventBus:function(){return new EventBus},unsubscribe:function(b){this.eventBus.unsubscribe(this.topicList[b]),delete this.topicList[b],a.log("cleared topic -> "+b)},publish:function(b,c){a.log("published -> "+b+" = "+c),this.eventBus.publish(b,c)},startModule:function(a){if(typeof a.id!="string"||a.id=="")throw new Error("Id provided is not String or it is a blank sting");if(this.moduleList[a.id]!==undefined)throw new Error("data.id::"+a.id+" is already contains a module.  Please provide separate id new module");a.parentNode=this.$,a.parentEventBus=this.eventBus,this.moduleList[a.id]=startApp(a)},endModule:function(a){c.Private.getModule.call(this,a).end(),delete this.moduleList[a]}};var d=function(d){var e=d.id,f=d.node,g=d.module,h=d.config,i=d.eventBus,j=d.parentEventBus,k=d.parentNode;if(g===undefined&&typeof g!=typeof {})throw new Error("data.module is undefined for data.id = "+d.id);var l=function(a,c){this.sb=a,this.id=a.id,k===undefined?this.$=document.querySelector("#"+this.id):this.$=k.querySelector("#"+this.id),this.sb.$=this.$,i===undefined?j===undefined?this.sb.eventBus=b:this.sb.eventBus=j:this.sb.eventBus=i,this.config=c};l.prototype=g,this.sandbox=new c(e,f),this.module=new l(this.sandbox,h),typeof this.module.template=="string"&&(this.module.$.innerHTML=this.module.template);if(typeof this.module.start!="function")throw new Error("data.module.start is undefined for data.id = "+this.module.id);this.module.start(),a.log("started module -> "+this.module.id)};return d.prototype={end:function(){c.Private.endAllModules.call(this.sandbox),typeof this.module.end=="function"&&this.module.end(),c.Private.eraseUI.call(this.sandbox),c.Private.unsubscribeAll.call(this.sandbox),c.Private.endSandbox.call(this.sandbox),a.log("ended module -> "+this.module.id),delete this.module,delete this.sandbox}},startApp=function(a){return new d(a)},{startApp:startApp,util:a}}();
